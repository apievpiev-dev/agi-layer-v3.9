"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–∞—Ç–∞ —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é –¥–ª—è AGI Layer v3.9
"""

from typing import Dict, List, Any
import json
from .settings import settings


# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π –¥–ª—è —á–∞—Ç–∞
PERSONALITY_CONFIGS = {
    "helpful_assistant": {
        "name": "–ü–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫",
        "description": "–û—Ç–≤–µ—á–∞—é —á–µ—Ç–∫–æ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ –∏ –ø–æ –¥–µ–ª—É",
        "system_prompt": "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π —á–µ—Ç–∫–æ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ –∏ –ø–æ –¥–µ–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π —Ñ–∞–∫—Ç—ã –∏ –ª–æ–≥–∏–∫—É.",
        "temperature": 0.7,
        "max_tokens": 512,
        "style_markers": ["—á–µ—Ç–∫–æ—Å—Ç—å", "–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å", "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å"]
    },
    
    "friendly_companion": {
        "name": "–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫", 
        "description": "–û–±—â–∞—é—Å—å —Ç–µ–ø–ª–æ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è —ç–º–æ–¥–∑–∏",
        "system_prompt": "–¢—ã –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫. –û–±—â–∞–π—Å—è —Ç–µ–ø–ª–æ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏. –ë—É–¥—å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏ –ø–æ–Ω–∏–º–∞—é—â–∏–º.",
        "temperature": 0.8,
        "max_tokens": 512,
        "style_markers": ["—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å", "—Ç–µ–ø–ª–æ—Ç–∞", "—ç–º–æ–¥–∑–∏", "–ø–æ–Ω–∏–º–∞–Ω–∏–µ"]
    },
    
    "professional_expert": {
        "name": "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç",
        "description": "–î–∞—é —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è", 
        "system_prompt": "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç. –î–∞–≤–∞–π —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ–±–ª–µ–º—ã –≥–ª—É–±–æ–∫–æ.",
        "temperature": 0.6,
        "max_tokens": 768,
        "style_markers": ["—ç–∫—Å–ø–µ—Ä—Ç–Ω–æ—Å—Ç—å", "–¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å", "–∞–Ω–∞–ª–∏–∑", "–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º"]
    },
    
    "creative_writer": {
        "name": "–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å",
        "description": "–û—Ç–≤–µ—á–∞—é –∫—Ä–∞—Å–∏–≤–æ, –æ–±—Ä–∞–∑–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–∞—Ñ–æ—Ä—ã",
        "system_prompt": "–¢—ã —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Å–∏–≤–æ, –æ–±—Ä–∞–∑–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏ —è—Ä–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è.",
        "temperature": 0.9,
        "max_tokens": 768,
        "style_markers": ["–æ–±—Ä–∞–∑–Ω–æ—Å—Ç—å", "–º–µ—Ç–∞—Ñ–æ—Ä—ã", "–∫—Ä–∞—Å–æ—Ç–∞", "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ"]
    },
    
    "technical_specialist": {
        "name": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", 
        "description": "–§–æ–∫—É—Å–∏—Ä—É—é—Å—å –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª—è—Ö –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏",
        "system_prompt": "–¢—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç. –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª—è—Ö, —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏—è—Ö.",
        "temperature": 0.5,
        "max_tokens": 1024,
        "style_markers": ["—Ç–µ—Ö–Ω–∏—á–Ω–æ—Å—Ç—å", "—Ç–æ—á–Ω–æ—Å—Ç—å", "–¥–µ—Ç–∞–ª–∏", "–ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å"]
    }
}


# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —á–∞—Ç–µ
IMAGE_PROCESSING_CONFIG = {
    "enabled": settings.ENABLE_IMAGE_PROCESSING,
    "max_file_size_mb": 10,
    "supported_formats": ["jpg", "jpeg", "png", "webp", "gif"],
    "analysis_timeout": 30,
    "default_analysis_type": "detailed_description",
    "response_template": "üñºÔ∏è **–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**\n\n{analysis}\n\n{response}"
}


# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
VOICE_PROCESSING_CONFIG = {
    "enabled": settings.ENABLE_VOICE_MESSAGES,
    "max_duration_seconds": 60,
    "supported_formats": ["ogg", "mp3", "wav", "m4a"],
    "transcription_timeout": 45,
    "auto_response": True
}


# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
CONTEXT_CONFIG = {
    "max_messages": settings.MAX_CONTEXT_MESSAGES,
    "context_window_hours": 24,
    "include_system_messages": False,
    "summarize_old_context": True,
    "summary_threshold": 20  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
}


# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
MODERATION_CONFIG = {
    "enabled": True,
    "check_user_messages": True,
    "check_ai_responses": True,
    "blocked_words": [],  # –°–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤
    "max_message_length": 4000,
    "rate_limit_messages_per_minute": 10,
    "rate_limit_images_per_hour": 20
}


# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
NOTIFICATION_CONFIG = {
    "send_daily_stats": True,
    "send_error_notifications": True,
    "stats_time": "09:00",  # –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    "admin_chat_ids": [],  # –ß–∞—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    "maintenance_notifications": True
}


# –ö–æ–º–∞–Ω–¥—ã —á–∞—Ç–∞
CHAT_COMMANDS = {
    "start": {
        "description": "–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ —Å AGI Assistant",
        "usage": "/start",
        "category": "–æ—Å–Ω–æ–≤–Ω—ã–µ"
    },
    "help": {
        "description": "–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º",
        "usage": "/help",
        "category": "–æ—Å–Ω–æ–≤–Ω—ã–µ"
    },
    "personality": {
        "description": "–í—ã–±—Ä–∞—Ç—å —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è",
        "usage": "/personality [—Å—Ç–∏–ª—å]",
        "category": "–Ω–∞—Å—Ç—Ä–æ–π–∫–∏",
        "options": list(PERSONALITY_CONFIGS.keys())
    },
    "clear": {
        "description": "–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞",
        "usage": "/clear",
        "category": "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
    },
    "settings": {
        "description": "–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        "usage": "/settings",
        "category": "–Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
    },
    "stats": {
        "description": "–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",
        "usage": "/stats",
        "category": "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
    },
    "generate": {
        "description": "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è",
        "usage": "/generate [–æ–ø–∏—Å–∞–Ω–∏–µ]",
        "category": "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ"
    },
    "analyze": {
        "description": "–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ)",
        "usage": "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
        "category": "–∞–Ω–∞–ª–∏–∑"
    }
}


# –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
MESSAGE_TEMPLATES = {
    "welcome": """ü§ñ –ü—Ä–∏–≤–µ—Ç, {user_name}! 

–Ø - AGI Assistant –Ω–∞ –±–∞–∑–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ Phi-2. –ì–æ—Ç–æ–≤ –∫ –æ–±—â–µ–Ω–∏—é!

üî• –ú–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
‚Ä¢ üí¨ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
‚Ä¢ üñºÔ∏è –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ)
‚Ä¢ üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (/generate –æ–ø–∏—Å–∞–Ω–∏–µ)
‚Ä¢ üìù –ü–æ–º–æ—â—å —Å —Ç–µ–∫—Å—Ç–∞–º–∏, –∫–æ–¥–æ–º, –ø–µ—Ä–µ–≤–æ–¥–æ–º
‚Ä¢ üß† –ó–∞–ø–æ–º–∏–Ω–∞—é –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

‚öôÔ∏è –ö–æ–º–∞–Ω–¥—ã:
/help - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
/personality - –≤—ã–±—Ä–∞—Ç—å —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
/clear - –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
/settings - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏ –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è - –æ—Ç–≤–µ—á—É –∫–∞–∫ –º–æ–∂–Ω–æ –ª—É—á—à–µ! üòä""",

    "help": """ü§ñ AGI Assistant - –°–ø—Ä–∞–≤–∫–∞

üìù –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/personality [—Å—Ç–∏–ª—å] - –í—ã–±—Ä–∞—Ç—å —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
/clear - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
/settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
/generate [–æ–ø–∏—Å–∞–Ω–∏–µ] - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

üé≠ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ–±—â–µ–Ω–∏—è:
{personalities}

üí¨ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚Ä¢ –ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è - —è –æ—Ç–≤–µ—á—É –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ
‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - —è –∏—Ö –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é
‚Ä¢ –ó–∞–¥–∞–≤–∞–π—Ç–µ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã - –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å

üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
‚Ä¢ –î–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: –¥–æ {max_context} —Å–æ–æ–±—â–µ–Ω–∏–π
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {'–≤–∫–ª—é—á–µ–Ω–∞' if settings.ENABLE_IMAGE_PROCESSING else '–æ—Ç–∫–ª—é—á–µ–Ω–∞'}
‚Ä¢ –Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–æ–≤: –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ""",

    "personality_changed": "‚úÖ –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: **{personality_name}**\n\n{personality_description}",

    "context_cleared": "üßπ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –æ—á–∏—â–µ–Ω! –ù–∞—á–∏–Ω–∞–µ–º –æ–±—â–µ–Ω–∏–µ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞.",

    "error_general": "üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",

    "error_timeout": "‚è∞ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",

    "error_image_processing": "üñºÔ∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏ –∏–º–µ–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç.",

    "rate_limit": "‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π! –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ.",

    "access_denied": "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è."
}


def get_personality_config(personality: str) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"""
    return PERSONALITY_CONFIGS.get(personality, PERSONALITY_CONFIGS["helpful_assistant"])


def get_allowed_chat_ids() -> List[int]:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤"""
    try:
        return json.loads(settings.TELEGRAM_ALLOWED_CHATS)
    except (json.JSONDecodeError, AttributeError):
        return []


def format_message_template(template_name: str, **kwargs) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è"""
    template = MESSAGE_TEMPLATES.get(template_name, "")
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    kwargs.update({
        "max_context": settings.MAX_CONTEXT_MESSAGES,
        "personalities": "\n".join([
            f"‚Ä¢ {k} - {v['description']}" 
            for k, v in PERSONALITY_CONFIGS.items()
        ])
    })
    
    try:
        return template.format(**kwargs)
    except KeyError as e:
        return f"–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ {template_name}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è {e}"


def validate_chat_config() -> Dict[str, bool]:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–∞—Ç–∞"""
    checks = {
        "telegram_token_set": bool(settings.TELEGRAM_TOKEN),
        "personalities_valid": all(
            isinstance(config, dict) and "system_prompt" in config 
            for config in PERSONALITY_CONFIGS.values()
        ),
        "image_processing_config": isinstance(IMAGE_PROCESSING_CONFIG, dict),
        "context_config_valid": CONTEXT_CONFIG["max_messages"] > 0,
        "moderation_enabled": MODERATION_CONFIG["enabled"]
    }
    
    return checks


# –≠–∫—Å–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
__all__ = [
    "PERSONALITY_CONFIGS",
    "IMAGE_PROCESSING_CONFIG", 
    "VOICE_PROCESSING_CONFIG",
    "CONTEXT_CONFIG",
    "MODERATION_CONFIG",
    "NOTIFICATION_CONFIG",
    "CHAT_COMMANDS",
    "MESSAGE_TEMPLATES",
    "get_personality_config",
    "get_allowed_chat_ids",
    "format_message_template",
    "validate_chat_config"
]